{"name":"Salt-api-reactor-formula","tagline":"A Saltstack salt-api and reactor formula for integrating HTTP webhooks with Saltstack executions","body":"## Purpose\r\n\r\nThe purpose of this formula is to allow you to call Saltstack via simple HTTP webhooks. You can use this formula for complicated setups like integrating your own application into Saltstack or for simple day to day tasks like having a provisioning script send a webhook to accept a new minion key. \r\n\r\n### A bit of background\r\n\r\nThis repo was/is the basis behind the Saltstack integration of [Runbook.io](https://runbook.io). Runbook is a SaaS service that monitors infrastructure and applications and if they are down or in an unhealthy state, it will perform automated actions to correct them. By implementing the contents of this repository a user can use Runbook to initiate salt executions when monitors fail. For example: running `service.restart nginx` when port 443 is no longer responding.\r\n\r\nWhile everything included is designed to work with Runbook, all of the configurations and reactor end points are generic enough that they can be used by anyone.\r\n\r\n## Some setup required\r\n\r\nBefore utilizing this formula you will first need to [setup salt-api](http://bencane.com/2014/07/17/integrating-saltstack-with-other-services-via-salt-api/) after salt-api is installed and configured you can simply copy a few files in place.\r\n\r\n    # cp reactor.conf /etc/salt/master.d\r\n    # cp -R reactor /srv/salt/\r\n    # service salt-master restart\r\n    # service salt-api restart\r\n\r\n### Replacing the default secretkey\r\n\r\nThis system uses a specific key for authenticating requests, the key is defined in eash reactor `SLS` file and must be updated there.\r\n\r\n**Replace this with something better:**\r\n\r\n    {% if postdata.secretkey == \"PICKSOMETHINGBETTERPLZKTHX\" %}\r\n\r\n## Usage\r\n\r\nAfter setup you can use web requests to perform Saltstack actions.\r\n\r\n**Restarting nginx:**\r\n\r\n    # curl -H \"Accept: application/json\" -d tgt='*' -d service=\"nginx\" \\\r\n    -d secretkey=\"replacethiswithsomethingbetter\" \\\r\n    -k https://10.0.0.2:8080/hook/services/restart\r\n    {\"success\": true}\r\n\r\n\r\n## Warning: Too much of a good thing\r\n\r\nBe very cautious of the salt-api reactors that you are implementing, in this set of reactor configurations we include 3 reactors that could be considered dangerous `reactor/init.sls`, `reactor/cmd/run.sls`, & `reactor/cmd/script.sls`. If a malicious user was able to bypass your salt-api security measurements these reactions would allow that user to execute abritrary and potentially harmful commands across your infrastructure. The use of these reactor configurations are at your own risk, and you are responsible for securing these configurations.","google":"","note":"Don't delete this file! It's used internally to help with page regeneration."}